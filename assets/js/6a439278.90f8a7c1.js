"use strict";(self.webpackChunkneon_docs=self.webpackChunkneon_docs||[]).push([[985],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>k});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=o.createContext({}),d=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=d(e.components);return o.createElement(l.Provider,{value:t},e.children)},c="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},b=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=d(n),b=a,k=c["".concat(l,".").concat(b)]||c[b]||p[b]||r;return n?o.createElement(k,i(i({ref:t},u),{},{components:n})):o.createElement(k,i({ref:t},u))}));function k(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=b;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[c]="string"==typeof e?e:a,i[1]=s;for(var d=2;d<r;d++)i[d]=n[d];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}b.displayName="MDXCreateElement"},4927:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>c,frontMatter:()=>r,metadata:()=>s,toc:()=>d});var o=n(7462),a=(n(7294),n(3905));const r={sidebar_position:6,displayed_sidebar:"neonkube",title:"Validating Webhooks",hide_title:!1,hide_table_of_contents:!1,description:"Validating Webhooks can validate resources when created/updated.",keywords:["neonkube kubernetes operator sdk resource validating webhooks"],last_update:{author:"Marcus Bowyer"}},i="Validating Webhooks",s={unversionedId:"neonkube/operator-sdk/validating-webhooks",id:"neonkube/operator-sdk/validating-webhooks",title:"Validating Webhooks",description:"Validating Webhooks can validate resources when created/updated.",source:"@site/docs/neonkube/operator-sdk/validating-webhooks.mdx",sourceDirName:"neonkube/operator-sdk",slug:"/neonkube/operator-sdk/validating-webhooks",permalink:"/docs/neonkube/operator-sdk/validating-webhooks",draft:!1,editUrl:"https://github.com/nforgeio/documentation/edit/master/docs/neonkube/operator-sdk/validating-webhooks.mdx",tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6,displayed_sidebar:"neonkube",title:"Validating Webhooks",hide_title:!1,hide_table_of_contents:!1,description:"Validating Webhooks can validate resources when created/updated.",keywords:["neonkube kubernetes operator sdk resource validating webhooks"],last_update:{author:"Marcus Bowyer"}},sidebar:"neonkube",previous:{title:"Mutating Webhooks",permalink:"/docs/neonkube/operator-sdk/mutating-webhooks"}},l={},d=[{value:"Introduction",id:"introduction",level:2},{value:"Example",id:"example",level:2}],u={toc:d};function c(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,o.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"validating-webhooks"},"Validating Webhooks"),(0,a.kt)("h2",{id:"introduction"},"Introduction"),(0,a.kt)("p",null,"Validating webhooks can be used to perform validations that go beyond the capabilities of OpenAPI schema validation.\nA validating Webhook can reject the request, but it cannot modify the object received in the request."),(0,a.kt)("mermaid",{value:"flowchart TD\n    A[User] -- kubectl apply resource.yaml --\x3e K[Kubernetes API] --\x3e V{ValidatingWebhook} --\x3e B[Is it?]\n    B --\x3e|Ok| K\n    B --\x3e|Fail| K"}),(0,a.kt)("h2",{id:"example"},"Example"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'[Webhook(\n    name: "pod-policy.neonkube.io",\n    serviceName: "example-operator",\n    @namespace: "default",\n    admissionReviewVersions: "v1",\n    failurePolicy: "Ignore")]\n[WebhookRule(\n    apiGroups: V1Pod.KubeGroup,\n    apiVersions: V1Pod.KubeApiVersion, \n    operations: AdmissionOperations.Create | AdmissionOperations.Update, \n    resources: V1Pod.KubePluralName,\n    scope: "*")]\npublic class PodWebhook : IValidatingWebhook<V1Pod>\n{\n    private Ilogger logger { get; set; }\n\n    public PodWebhook(Ilogger logger)\n        : base()\n    {\n        this.logger = logger;\n    }\n\n    public async Task<ValidationResult> CreateAsync(V1Pod entity, bool dryRun)\n    {\n        if (entity.Metadata.Name == "invalid-entity")\n        {\n            logger.LogInformation($"Entity name is not valid. [{entity.Namespace()}/{entity.Name()}]");\n\n            return ValidationResult.Fail(statusCode: 500, statusMessage: "Entity name is not valid.");\n        }\n\n        return ValidationResult.Success();\n    }\n\n    public async Task<ValidationResult> UpdateAsync(V1Pod entity, V1Pod oldEntity, bool dryRun)\n    {\n        if (entity.Metadata.Name == "invalid-entity")\n        {\n            logger.LogInformation($"Entity name is not valid. [{entity.Namespace()}/{entity.Name()}]");\n\n            return ValidationResult.Fail(statusCode: 500, statusMessage: "Entity name is not valid.");\n        }\n\n        return ValidationResult.Success();\n    }\n')))}c.isMDXComponent=!0}}]);